{% extends "layout.html" %}

{% block title %}
    Drive!
{% endblock %}

{% block main %}

      {% if user_name %}
          <div><h3>Welcome {{ user_name }}!</h3></div>
      {% endif %}

      <div class='container'>
      <p id="drive_header">Control Panel: <span id="timer" class="drive_timer"></span></p>
          <form>
              <a href=# id=left><button class="btn btn-default">Left</button></a>
              <a href=# id=right><button class="btn btn-default">Right</button></a>
              <a href=# id=forward><button class="btn btn-default">Forward</button></a>
              <a href=# id=reverse><button class="btn btn-default">Reverse</button></a>
              <a href=# id=shot><button class="btn btn-default"">Shot!</button></a>
          </form>
      </div>

      <script>
      // Update the count down every 1 second
      var x = setInterval(function() {

        $.getJSON('/time_left', function(data) {

          end_time = data.end_time; // unix epoch time, in seconds, that ends our turn
          var distance = end_time - (Date.now()/1000); // Date.now() units are ms not s
          // Time calculations for minutes and seconds
          var minutes = Math.floor((distance % (60 * 60)) / 60);
          var seconds = Math.floor(distance % 60);

          // Display the result in the element with id="demo"
          document.getElementById("timer").innerHTML = minutes + "m " + seconds + "s ";

            // If the count down is finished, write some text
            if (distance <= 0) {
              clearInterval(x);
              document.getElementById("timer").innerHTML = "EXPIRED";
              $.get('/drive_timeout', function(response) {
                if (response.redirect) {
                  window.location.href = response.redirect;
                }
              }); // get
            } // if distance
          }); // getJSON
      }, 1000);
      </script>

{% endblock %}
